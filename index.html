<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Исторический турнир</title>
        <style type="text/css">
            body {
                font: 10pt Arial, Helvetica, sans-serif;
                background: white;
            }
            h2 {
                margin-top: 0;
            }
            textarea, button {
                border: 0;
                outline: none;
            }
            a {
                text-decoration: none;
                color: black;
            }
            #container {
                width: auto;
                height: 720px;
                margin: 0 auto;
            }
            #header {
                text-align: center;
                padding: 5px;
                background: #202020;
                color: white;
            }
            #sidebar {  
                margin-top: 10px;
                width: 110px;
                padding: 0 10px;
                float: left;
            }
            #content {
                margin-left: 130px;
                background: #fff;
            }
            .tabs{
                margin: 0;
                padding: 0;
            }
            .tab {
                padding: 0;
                margin: 0;
                height: 300px;
                width: 1310px;
                float: left;
                resize: none;
                display: none;
                color: white;
                background-color: #272822;
            }
            .tabs > li {
                list-style-type: none;
                display: inline-block;
                padding: 10px 5px;
            }
            .tabs a {
                color: black;
            }
            #selected {
                background-color: #272822;
            }
            #selected > a {
                color: white;
            }
            #stdin{
                display: block;
                border: 0;
                padding: 0;
            }
            #button {
                padding: 0;
                margin: 0;
                display: inline;
                float: left;
                background-color: #272822;
                color: white;
                width: 75px;
                height: 300px;
                border-left: 5px solid white;
            }
            #editor {
                height: 40vh;
                width: auto;
            }
        </style>
    </head>
    <body>

        <div id="container">
            <div id="header">Бессмысленное и беспощедное дерьмо</div>
            <div id="sidebar">
                <p><a href="hui.html">Первый пункт меню</a></p>
                <p><a href="hui.html">Второй пункт меню</a></p>
                <p><a href="hui.html">Третий пункт меню</a></p>
            </div>
            <div id="content">
                <div id="editor">#include &lt;iostream&gt;

using namespace std;

int main(){

    cout &lt;&lt; "Hello World!" &lt;&lt; endl;

    return 0;
}
            </div>
                
                 <ul class="tabs">
                    <li id="selected" class="stdinL"><a href="javascript:void(0)" onclick="changeTab('stdin')">Input</a></li>
                    <li class="outputL"><a href="javascript:void(0)" onclick="changeTab('output')">Output</a></li>
                    <li class="errorsL"><a href="javascript:void(0)" onclick="changeTab('errors')">Errors</a></li>
                </ul>
                <div> <!--Тут контейнер!!!-->
                    <textarea id="stdin" class="tab"></textarea>
                    <textarea id="output" class="tab" readonly="readonly"></textarea>
                    <textarea id="errors" class="tab" readonly="readonly"></textarea>

                    <button onclick="sendCode()" id="button">Send</button>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/g/ace@1.2.6(min/ace.js+min/mode-pascal.js+min/snippets/pascal.js+min/mode-c_cpp.js+min/snippets/c_cpp.js+min/theme-monokai.js)" type="text/javascript" charset="utf-8"></script>
        <script type=""application/javascript"" charset="utf-8">
            var editor = ace.edit("editor")
            var output = document.getElementById("output")
            var stdin  = document.getElementById("stdin")
            var errors = document.getElementById("errors")

            editor.setTheme("ace/theme/monokai")
            editor.getSession().setMode("ace/mode/c_cpp")
            output.value = ''
            stdin.value  = ''
            errors.value = ''
            
            function changeTab(tabName){
                var i
                var x = document.getElementsByClassName("tab")

                for (i = 0; i < x.length; i++) {
                    x[i].style.display = 'none'
                }

                document.getElementById(tabName).style.display = "block"
                document.getElementById('selected').id = ''
                document.getElementsByClassName(tabName + 'L')[0].id = 'selected'
            }

            function sendCode(){
                var xhr = new XMLHttpRequest()
                var body = JSON.stringify({
                    code: editor.getSession().getValue(),
                    input: stdin.value
                });

                output.value = ''
                stdin.value = ''
                errors.value = ''

                xhr.open('POST', '/compile', true)
                xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8')
                xhr.send(body)
                xhr.onreadystatechange = function() {
                    if (xhr.readyState != 4) return;

                    button.innerHTML = "Send"
                    button.disabled = false
                    var res = JSON.parse(xhr.responseText)
                    output.value = res.output
                    errors.value = res.err
					if(res.output != ''){
                        changeTab('output')
					}
					if(res.output === '' && res.errors != ''){
                        changeTab('errors')
					}
                }

                button.innerHTML = 'Loading...'
                button.disabled = true
                setTimeout(() => {button.innerHTML = "Send"; button.disabled = false}, 6500)
            }
    </script>

    </body>
</html>
